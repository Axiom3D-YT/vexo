<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Bot Analytics</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/dashboard.css?v=1.1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="view-global">
    <header class="top-bar">
        <div class="top-logo">
            <span style="font-size: 1.5rem;">üéµ</span> Music Bot
        </div>

        <div class="server-nav" id="server-nav">
            <div class="server-nav-item active" onclick="switchScope('global')">Global</div>
            <!-- Populated by JS -->
        </div>

        <div class="top-actions">
            <button class="btn btn-secondary" onclick="switchTab('logs')"
                style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem;">
                <span>üìú</span> Logs
            </button>
            <button class="btn btn-secondary" onclick="openGlobalSettings()"
                style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem;">
                <span>‚öôÔ∏è</span> Global Settings
            </button>
            <div class="notification-badge" onclick="toggleNotifications()">
                <button class="btn-icon">üîî</button>
                <div class="badge-dot" id="notif-dot" style="display: none;"></div>
                <div class="notifications-dropdown" id="notif-dropdown">
                    <div class="notif-header">Notifications</div>
                    <div class="notif-list" id="notif-list">
                        <div class="notif-item" style="color: var(--text-muted); text-align: center;">No new
                            notifications</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="app">
        <aside class="sidebar">
            <div class="logo">
                <span class="logo-icon">üéµ</span>
                <span>Music Bot</span>
            </div>

            <nav>
                <ul class="nav">
                    <li class="nav-item"><a href="#" class="nav-link tab active" data-tab="dashboard">üìä Dashboard</a>
                    </li>
                    <li class="nav-item"><a href="#" class="nav-link tab" data-tab="library">üìö Song Library</a></li>
                    <li class="nav-item"><a href="#" class="nav-link tab" data-tab="songs">üïí Song History</a></li>
                    <li class="nav-item"><a href="#" class="nav-link tab" data-tab="users">üë• Users</a></li>
                    <li class="nav-item" data-global-only="true"><a href="#" class="nav-link tab" data-tab="servers">üè†
                            Servers</a></li>
                    <li class="nav-item"><a href="#" class="nav-link tab" data-tab="settings">‚öôÔ∏è Settings</a></li>
                    <li class="nav-item" data-global-only="true"><a href="#" class="nav-link tab" data-tab="logs">üìú
                            Logs</a></li>
                </ul>
            </nav>

            <div class="status-card">
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span class="status-dot status-online"></span>
                    <span id="status-text">Connecting...</span>
                </div>
                <div style="margin-top: 0.5rem; font-size: 0.8rem; color: var(--text-muted);">
                    Latency: <span id="stat-latency">--</span>
                </div>
            </div>
        </aside>

        <main class="main">
            <!-- DASHBOARD TAB -->
            <div id="tab-dashboard" class="tab-content active">
                <!-- Global Recap View (Only visible in Global scope) -->
                <div id="global-recap" class="recap-dashboard">
                    <div class="stats-grid">
                        <div class="card stat-card">
                            <div class="stat-value" id="stat-songs-global">0</div>
                            <div class="stat-label">Total Songs</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="stat-plays-global">0</div>
                            <div class="stat-label">Total Plays</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="stat-users-global">0</div>
                            <div class="stat-label">Active Users</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="stat-latency-val">0ms</div>
                            <div class="stat-label">API Latency</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="stat-cpu">0%</div>
                            <div class="stat-label">CPU Usage</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="stat-ram">0%</div>
                            <div class="stat-label">RAM Usage</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="stat-uptime">0s</div>
                            <div class="stat-label">Uptime</div>
                        </div>
                    </div>

                    <div class="content-grid recap-grid" style="grid-template-columns: 1fr 1fr;">
                        <div class="card chart-card">
                            <div class="card-header">
                                <h3 class="card-title">üéµ Daily Playback Trends</h3>
                            </div>
                            <canvas id="plays-chart"></canvas>
                        </div>
                        <div class="card chart-card">
                            <div class="card-header">
                                <h3 class="card-title">üïí Peak Activity Hours</h3>
                            </div>
                            <canvas id="peak-chart"></canvas>
                        </div>
                        <div class="card chart-card">
                            <div class="card-header">
                                <h3 class="card-title">üé∑ Genre Distribution</h3>
                            </div>
                            <canvas id="genres-chart" height="200"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Server Dashboard View (Only visible in Server scope) -->
                <div id="server-dashboard" class="server-only" style="display: none;">
                    <div class="stats-grid">
                        <div class="card stat-card">
                            <div class="stat-value" id="server-stat-members">0</div>
                            <div class="stat-label">Members</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="server-stat-queue">0</div>
                            <div class="stat-label">Songs in Queue</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-value" id="server-stat-duration">0m</div>
                            <div class="stat-label">Queue Duration</div>
                        </div>
                    </div>

                    <div class="card now-playing" id="now-playing" style="margin-bottom: 1.5rem;">
                        <div class="np-content" style="justify-content: center;">
                            <span style="color: var(--text-muted);">Nothing playing</span>
                        </div>
                    </div>

                    <div class="content-grid" style="grid-template-columns: 1fr; margin-bottom: 1.5rem;">
                        <div class="card chart-card">
                            <div class="card-header">
                                <h3 class="card-title">üìà Server Playback Activity</h3>
                            </div>
                            <canvas id="server-plays-chart" height="150"></canvas>
                        </div>
                    </div>

                    <div class="content-grid">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üî• Most Played Songs</h2>
                            </div>
                            <div class="table-container">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Song</th>
                                            <th>Plays</th>
                                            <th>Likes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="top-songs-table">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">üë• Top Users</h2>
                            </div>
                            <div class="user-list" id="top-users-list">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Music Insights Grid -->
                <div class="content-grid" style="grid-template-columns: repeat(3, 1fr); margin-top: 1.5rem;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">‚ù§Ô∏è Most Liked</h2>
                        </div>
                        <div id="liked-stats" class="insights-list">
                            <div class="insight-item" style="margin-bottom: 1rem;">
                                <div class="stat-label">Genre</div>
                                <div class="insight-value" id="insight-liked-genre" style="font-weight: 600;">-</div>
                            </div>
                            <div class="insight-item" style="margin-bottom: 1rem;">
                                <div class="stat-label">Artist</div>
                                <div class="insight-value" id="insight-liked-artist" style="font-weight: 600;">-</div>
                            </div>
                            <div class="insight-item">
                                <div class="stat-label">Song</div>
                                <div class="insight-value" id="insight-liked-song"
                                    style="font-weight: 600; font-size: 0.9rem;">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üéß Top Played</h2>
                        </div>
                        <div id="played-stats" class="insights-list">
                            <div class="insight-item" style="margin-bottom: 1rem;">
                                <div class="stat-label">Most Played Genre</div>
                                <div class="insight-value" id="insight-played-genre" style="font-weight: 600;">-</div>
                            </div>
                            <div class="insight-item">
                                <div class="stat-label">Most Played Artist</div>
                                <div class="insight-value" id="insight-played-artist" style="font-weight: 600;">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">üèÜ Useful Users</h2>
                        </div>
                        <div id="useful-users-list" class="user-list">
                            <div style="text-align: center; color: var(--text-muted);">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LIBRARY TAB -->
            <div id="tab-library" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üìö Song Library</h2>
                    </div>
                    <div class="table-container">
                        <table id="library-table">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Artist</th>
                                    <th>Year</th>
                                    <th>Genre</th>
                                    <th>Source(s)</th>
                                    <th>Added By</th>
                                    <th>Added At</th>
                                </tr>
                            </thead>
                            <tbody id="library-list">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination" id="library-pagination"></div>
                </div>
            </div>

            <!-- SONGS TAB -->
            <div id="tab-songs" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üïí Playback History</h2>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Artist</th>
                                    <th>Year</th>
                                    <th>Duration</th>
                                    <th>Genre</th>
                                    <th>Requested By</th>
                                    <th>Liked By</th>
                                    <th>Disliked By</th>
                                    <th>Played At</th>
                                </tr>
                            </thead>
                            <tbody id="songs-list">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- USERS TAB -->
            <div id="tab-users" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üë• User Directory</h2>
                    </div>
                    <div class="user-list" id="users-directory">
                        <div style="text-align: center; color: var(--text-muted);">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- SERVERS TAB -->
            <div id="tab-servers" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">üè† Active Servers</h2>
                    </div>
                    <div class="user-list" id="guild-list">
                        <div style="text-align: center; color: var(--text-muted);">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- SETTINGS TAB -->
            <div id="tab-settings" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title" id="settings-title">‚öôÔ∏è Settings</h2>
                    </div>
                    <div class="card-body">
                        <!-- GLOBAL SETTINGS -->
                        <div id="settings-global" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">Max Concurrent Servers</label>
                                <input type="number" id="setting-max-servers-tab" class="form-input"
                                    placeholder="Default: Unlimited" style="max-width: 300px;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                    If the bot is in more servers than this limit, it will auto-leave new joins.
                                </div>
                            </div>

                            <hr style="border: 0; border-top: 1px solid var(--border); margin: 2rem 0;">

                            <div class="form-group"
                                style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label" style="color: var(--warning); font-weight: 700;">‚ö†Ô∏è Test
                                        Mode</label>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                                        Every song will be limited to a fixed duration for stress testing.
                                        <strong>Global setting!</strong>
                                    </div>
                                </div>
                                <div>
                                    <input type="checkbox" id="setting-test-mode" style="transform: scale(1.5);">
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label class="form-label">Test Mode Playback Duration (Seconds)</label>
                                <input type="number" id="setting-test-duration" class="form-input"
                                    placeholder="Default: 30" min="5" max="300" style="max-width: 300px;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                    How long to play each song before skipping (default: 30).
                                </div>
                            </div>

                            <hr style="border: 0; border-top: 1px solid var(--border); margin: 2rem 0;">

                            <div style="margin-top: 2rem;">
                                <button class="btn btn-primary" onclick="saveSettingsTab()">Save Global
                                    Settings</button>
                            </div>
                        </div>

                        <!-- SERVER SETTINGS -->
                        <div id="settings-server" style="display: none;">
                            <h3 style="font-size: 1rem; margin-bottom: 1rem;">‚öôÔ∏è General Server Settings</h3>
                            <div class="form-group"
                                style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Pre-buffering</label>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                                        Prepare the next song before the current one ends.
                                    </div>
                                </div>
                                <div>
                                    <input type="checkbox" id="setting-pre-buffer" style="transform: scale(1.5);">
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label class="form-label">Buffer Amount (Seconds)</label>
                                <input type="number" id="setting-buffer-amount" class="form-input" placeholder="e.g. 30"
                                    min="10" max="120" style="max-width: 300px;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                    How many seconds before the end of the song to start buffering.
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label class="form-label">Max Song Duration (Minutes)</label>
                                <input type="number" id="setting-max-duration" class="form-input" placeholder="e.g. 6"
                                    min="1" max="120" style="max-width: 300px;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                    Prevent extremely long songs from being queued.
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label class="form-label">Message Auto-Delete Duration (Seconds)</label>
                                <input type="number" id="setting-ephemeral-duration" class="form-input"
                                    placeholder="e.g. 10" min="0" max="60" style="max-width: 300px;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                    How long to keep bot messages before auto-deleting.
                                </div>
                            </div>

                            <hr style="border: 0; border-top: 1px solid var(--border); margin: 2rem 0;">

                            <h3 style="font-size: 1rem; margin-bottom: 1rem;">üïí Playback & Connectivity</h3>
                            <div class="form-group"
                                style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">24/7 Mode</label>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                                        Keep the bot in the voice channel even when everyone leaves.
                                    </div>
                                </div>
                                <div>
                                    <input type="checkbox" id="setting-247" style="transform: scale(1.5);">
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1.5rem;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div>
                                        <label class="form-label">Auto-Connect</label>
                                        <div style="font-size: 0.8rem; color: var(--text-muted);">
                                            Automatically join a specific channel on startup or when idle.
                                        </div>
                                    </div>
                                    <div>
                                        <input type="checkbox" id="setting-autoconnect" style="transform: scale(1.5);">
                                    </div>
                                </div>
                                <div id="autoconnect-options"
                                    style="margin-top: 1rem; padding-left: 1rem; border-left: 2px solid var(--border); display: none;">
                                    <label class="form-label" style="font-size: 0.8rem;">Target Voice Channel</label>
                                    <select id="setting-autoconnect-channel" class="form-input">
                                        <!-- Populated by JS -->
                                        <option value="">Select a channel...</option>
                                    </select>
                                </div>
                            </div>

                            <hr style="border: 0; border-top: 1px solid var(--border); margin: 2rem 0;">

                            <h3 style="font-size: 1rem; margin-bottom: 1rem;">ü§ñ Groq DJ Enhancements</h3>
                            <div class="form-group"
                                style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Enable Groq Integration</label>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                                        Generate dynamic DJ scripts for this server.
                                    </div>
                                </div>
                                <div>
                                    <input type="checkbox" id="setting-groq-enabled" style="transform: scale(1.5);">
                                </div>
                            </div>

                            <div id="groq-advanced-options" style="display: none;">
                                <div class="form-group"
                                    style="margin-top: 1.5rem; display: flex; align-items: center; justify-content: space-between;">
                                    <div>
                                        <label class="form-label">Send Text Messages</label>
                                        <div style="font-size: 0.8rem; color: var(--text-muted);">
                                            Post the DJ scripts as text in the channel.
                                        </div>
                                    </div>
                                    <div>
                                        <input type="checkbox" id="setting-groq-text" style="transform: scale(1.5);">
                                    </div>
                                </div>

                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <label class="form-label">Primary Request Model</label>
                                    <select id="setting-groq-model" class="form-input" style="max-width: 300px;"
                                        onchange="toggleCustomModelInput()">
                                        <option value="groq/compound">Compound (Router)</option>
                                        <option value="groq/compound-mini">Compound Mini (Fastest)</option>
                                        <option value="llama-3.1-8b-instant">Llama 3.1 8B</option>
                                        <option value="llama-3.3-70b-versatile">Llama 3.3 70B</option>
                                        <option value="llama-4-scout-17b-16e-instruct">Llama 4 Scout 17B</option>
                                        <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                                        <option value="gemma2-9b-it">Gemma 2 9B IT</option>
                                        <option value="openai/gpt-oss-120b">GPT-OSS 120B</option>
                                        <option value="moonshotai/kimi-k2-instruct-0905">Kimi K2 Instruct</option>
                                        <option value="qwen/qwen3-32b">Qwen 3 32B</option>
                                        <option value="custom">Custom...</option>
                                    </select>
                                    <input type="text" id="setting-groq-model-custom" class="form-input"
                                        placeholder="Enter custom model ID"
                                        style="max-width: 300px; margin-top: 0.5rem; display: none;">
                                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                        Select the primary AI model for script generation.
                                    </div>
                                </div>

                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <label class="form-label">Fallback Model (Rate Limit)</label>
                                    <select id="setting-groq-model-fallback" class="form-input"
                                        style="max-width: 300px;">
                                        <option value="">None</option>
                                        <option value="groq/compound-mini">Compound Mini (Fastest)</option>
                                        <option value="llama-3.1-8b-instant">Llama 3.1 8B</option>
                                        <option value="llama-3.3-70b-versatile">Llama 3.3 70B</option>
                                        <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                                        <option value="openai/gpt-oss-120b">GPT-OSS 120B</option>
                                    </select>
                                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                        If the primary model hits a rate limit, this model will be used immediately.
                                    </div>
                                </div>

                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <label class="form-label">Timing Offset (Seconds)</label>
                                    <input type="number" id="setting-groq-offset" class="form-input"
                                        placeholder="e.g. 5 or -5" style="max-width: 150px;">
                                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                                        Delay script generation. Positive = later, Negative = as early as possible.
                                    </div>
                                </div>

                                <div class="form-group" style="margin-top: 1.5rem;">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                        <label class="form-label" style="margin: 0;">Custom Prompts</label>
                                        <button class="btn btn-primary btn-sm" onclick="addGroqPrompt()">+ Add
                                            New</button>
                                    </div>

                                    <div id="groq-prompts-list"
                                        style="display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1rem;">
                                        <!-- Dynamic items with checkboxes -->
                                    </div>

                                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.75rem;">
                                        A random prompt will be selected from the <strong>enabled</strong> items below
                                        for each song.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PROMPT EDITOR MODAL -->
                        <div id="prompt-editor-modal" class="modal-overlay">
                            <div class="modal" style="width: 600px; max-width: 95vw;">
                                <div class="modal-header">
                                    <h2 class="modal-title" id="prompt-editor-title">Edit Prompt</h2>
                                    <button class="btn-icon" onclick="closePromptEditor()">‚úï</button>
                                </div>
                                <div class="modal-body" style="padding: 1.5rem; max-height: 70vh; overflow-y: auto;">
                                    <input type="hidden" id="edit-prompt-index" value="-1">

                                    <div class="form-group">
                                        <label class="form-label">Name</label>
                                        <input type="text" id="edit-prompt-name" class="form-input"
                                            placeholder="e.g. My Custom Persona">
                                    </div>

                                    <div class="form-group" style="margin-top: 1rem;">
                                        <label class="form-label">Role / Persona</label>
                                        <textarea id="edit-prompt-role" class="form-input" rows="3"
                                            placeholder="Who is the AI?"></textarea>
                                    </div>

                                    <div class="form-group" style="margin-top: 1rem;">
                                        <label class="form-label">Task</label>
                                        <textarea id="edit-prompt-task" class="form-input" rows="2"
                                            placeholder="What should the AI do?"></textarea>
                                    </div>

                                    <div class="form-group" style="margin-top: 1rem;">
                                        <label class="form-label">Strict Guidelines</label>
                                        <textarea id="edit-prompt-guidelines" class="form-input" rows="4"
                                            placeholder="Rules to follow..."></textarea>
                                    </div>

                                    <div class="form-group" style="margin-top: 1rem;">
                                        <label class="form-label">Vocal Cues</label>
                                        <input type="text" id="edit-prompt-vocal" class="form-input"
                                            placeholder="Instructions on delivery/style">
                                    </div>

                                    <details style="margin-top: 1rem; cursor: pointer;">
                                        <summary style="font-size: 0.9rem; color: var(--text-muted);">Advanced Options
                                        </summary>
                                        <div class="form-group" style="margin-top: 0.5rem;">
                                            <label class="form-label">Max Word Count</label>
                                            <input type="text" id="edit-prompt-words" class="form-input"
                                                value="Keep it under 40 words.">
                                        </div>
                                        <div class="form-group" style="margin-top: 1rem;">
                                            <label class="form-label">Output Format</label>
                                            <textarea id="edit-prompt-format" class="form-input" rows="4" disabled
                                                style="opacity: 0.7; cursor: not-allowed;"></textarea>
                                            <div style="font-size: 0.7rem; color: var(--text-muted);">Format is locked
                                                to ensure JSON compatibility.</div>
                                        </div>
                                    </details>
                                </div>
                                <div class="modal-footer"
                                    style="padding: 1rem 1.5rem; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 0.5rem;">
                                    <button class="btn btn-secondary" onclick="closePromptEditor()">Cancel</button>
                                    <button class="btn btn-primary" onclick="savePrompt()">Save Prompt</button>
                                </div>
                            </div>
                        </div>
                        <!-- MODALS -->
                        <div id="preset-modal" class="modal-overlay">
                            <div class="modal" style="max-width: 500px;">
                                <div class="modal-header">
                                    <h2 class="modal-title">Load Prompt Preset</h2>
                                    <button class="btn-icon" onclick="closePresetModal()">‚úï</button>
                                </div>
                                <div class="modal-body"
                                    style="padding: 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <button class="btn btn-secondary"
                                        style="height: auto; padding: 1rem; text-align: left;"
                                        onclick="loadPreset('friend')">
                                        <strong>ü§ù The Friend</strong><br><span
                                            style="font-size: 0.7rem; opacity: 0.7;">Natural & Chill</span>
                                    </button>
                                    <button class="btn btn-secondary"
                                        style="height: auto; padding: 1rem; text-align: left;"
                                        onclick="loadPreset('critic')">
                                        <strong>üßê The Critic</strong><br><span
                                            style="font-size: 0.7rem; opacity: 0.7;">Snarky & Technical</span>
                                    </button>
                                    <button class="btn btn-secondary"
                                        style="height: auto; padding: 1rem; text-align: left;"
                                        onclick="loadPreset('hype')">
                                        <strong>üî• Hype Man</strong><br><span
                                            style="font-size: 0.7rem; opacity: 0.7;">Energetic Club Vibes</span>
                                    </button>
                                    <button class="btn btn-secondary"
                                        style="height: auto; padding: 1rem; text-align: left;"
                                        onclick="loadPreset('jazz')">
                                        <strong>üé∑ Jazz Cat</strong><br><span
                                            style="font-size: 0.7rem; opacity: 0.7;">Smooth & Poetic</span>
                                    </button>
                                    <button class="btn btn-secondary"
                                        style="height: auto; padding: 1rem; text-align: left;"
                                        onclick="loadPreset('history')">
                                        <strong>üìö History Buff</strong><br><span
                                            style="font-size: 0.7rem; opacity: 0.7;">Trivia & Facts</span>
                                    </button>
                                    <button class="btn btn-secondary"
                                        style="height: auto; padding: 1rem; text-align: left;"
                                        onclick="loadPreset('zen')">
                                        <strong>üßò Zen Master</strong><br><span
                                            style="font-size: 0.7rem; opacity: 0.7;">Minimal & Deep</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div id="autogen-modal" class="modal-overlay">
                            <div class="modal" style="max-width: 500px;">
                                <div class="modal-header">
                                    <h2 class="modal-title">‚ú® Autogenerate Prompt</h2>
                                    <button class="btn-icon" onclick="closeAutogenModal()">‚úï</button>
                                </div>
                                <div class="modal-body" style="padding: 1.5rem;">
                                    <div class="form-group">
                                        <label class="form-label">Base Persona</label>
                                        <select id="autogen-persona" class="form-input">
                                            <option value="DJ">Standard DJ</option>
                                            <option value="Expert">Music Expert</option>
                                            <option value="Fan">Passionate Fan</option>
                                            <option value="Rapper">Street Wise</option>
                                            <option value="Poet">Deep Thinker</option>
                                        </select>
                                    </div>
                                    <div class="form-group" style="margin-top: 1rem;">
                                        <label class="form-label">Vibe / Mood</label>
                                        <select id="autogen-vibe" class="form-input">
                                            <option value="happy">Energetic & Happy</option>
                                            <option value="dark">Dark & Gritty</option>
                                            <option value="chill">Chill & Relaxed</option>
                                            <option value="funny">Humorous & Witty</option>
                                            <option value="sad">Emotional & Nostalgic</option>
                                        </select>
                                    </div>
                                    <div class="form-group" style="margin-top: 1rem;">
                                        <label class="form-label">Detail Level</label>
                                        <select id="autogen-detail" class="form-input">
                                            <option value="brief">Brief (One liner)</option>
                                            <option value="balanced">Balanced (2-3 sentences)</option>
                                            <option value="deep">Deep (Rich descriptions)</option>
                                        </select>
                                    </div>
                                    <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                                        <button class="btn btn-primary" style="flex: 1;" onclick="applyAutogen()">Create
                                            Prompt</button>
                                        <button class="btn btn-secondary" onclick="closeAutogenModal()">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <hr style="border: 0; border-top: 1px solid var(--border); margin: 2rem 0;">

                        <h3 style="font-size: 1rem; margin-bottom: 1rem;">üîä VexoTTS Settings</h3>
                        <div class="form-group"
                            style="display: flex; align-items: center; justify-content: space-between;">
                            <div>
                                <label class="form-label">Enable TTS</label>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">
                                    Play the DJ script via voice in the channel.
                                </div>
                            </div>
                            <div>
                                <input type="checkbox" id="setting-tts-enabled" style="transform: scale(1.5);">
                            </div>
                        </div>

                        <div id="tts-options" style="display: none;">
                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label class="form-label">Voice Selection</label>
                                <select id="setting-tts-voice" class="form-input">
                                    <optgroup label="TikTok Voices" id="tts-voices-tiktok"></optgroup>
                                    <optgroup label="Google Voices" id="tts-voices-gtts"></optgroup>
                                </select>
                            </div>

                            <div class="form-group"
                                style="margin-top: 1.5rem; display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label class="form-label">Slow Mode</label>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                                        Speak at a slower pace.
                                    </div>
                                </div>
                                <div>
                                    <input type="checkbox" id="setting-tts-slow" style="transform: scale(1.5);">
                                </div>
                            </div>
                        </div>

                        <hr style="border: 0; border-top: 1px solid var(--border); margin: 2rem 0;">

                        <h3 style="font-size: 1rem; margin-bottom: 1rem;">üéØ Discovery Strategies</h3>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">
                            Adjust the weights for different recommendation strategies. Total must equal 100.
                        </div>
                        <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Similar Song (Strategy 1)</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="number" id="weight-similar" class="form-input weight-input" value="60"
                                        min="0" max="100" oninput="validateWeights()">
                                    <span>%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Same Artist (Strategy 2)</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="number" id="weight-artist" class="form-input weight-input" value="10"
                                        min="0" max="100" oninput="validateWeights()">
                                    <span>%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Wildcard (Strategy 3)</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="number" id="weight-wildcard" class="form-input weight-input" value="30"
                                        min="0" max="100" oninput="validateWeights()">
                                    <span>%</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Library (Strategy 4)</label>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="number" id="weight-library" class="form-input weight-input" value="0"
                                        min="0" max="100" oninput="validateWeights()">
                                    <span>%</span>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 0.5rem; font-weight: 500; text-align: right;">
                            Total: <span id="weights-total">100</span>%
                        </div>

                        <hr style="border: 0; border-top: 1px solid var(--border); margin: 2rem 0;">

                        <h3 style="font-size: 1rem; margin-bottom: 1rem;">üîç Metadata Configuration</h3>
                        <div class="form-group" style="margin-bottom: 1.5rem;">
                            <label class="form-label">Resolution Strategy</label>
                            <select id="meta-strategy" class="form-input" style="max-width: 300px;">
                                <option value="fallback">Fallback (Priority Order)</option>
                                <option value="consensus">Consensus (Most Agreed Genre)</option>
                            </select>
                        </div>

                        <div class="metadata-grid" style="display: grid; gap: 1rem;">
                            <!-- Spotify -->
                            <div class="card" style="padding: 1rem; border: 1px solid var(--border);">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <div style="font-weight: 600;">Spotify</div>
                                    <input type="checkbox" id="meta-spotify-enabled" checked disabled>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-size: 0.8rem;">Priority</label>
                                    <input type="number" id="meta-spotify-prio" class="form-input" value="1" min="1"
                                        max="10">
                                </div>
                            </div>

                            <!-- Discogs -->
                            <div class="card" style="padding: 1rem; border: 1px solid var(--border);">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <div style="font-weight: 600;">Discogs</div>
                                    <input type="checkbox" id="meta-discogs-enabled">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-size: 0.8rem;">Priority</label>
                                    <input type="number" id="meta-discogs-prio" class="form-input" value="2" min="1"
                                        max="10">
                                </div>
                            </div>

                            <!-- MusicBrainz -->
                            <div class="card" style="padding: 1rem; border: 1px solid var(--border);">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <div style="font-weight: 600;">MusicBrainz</div>
                                    <input type="checkbox" id="meta-mb-enabled">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" style="font-size: 0.8rem;">Priority</label>
                                    <input type="number" id="meta-mb-prio" class="form-input" value="3" min="1"
                                        max="10">
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                            <button class="btn btn-primary" onclick="saveServerSettings()">Save Server
                                Settings</button>
                            <button class="btn btn-danger" onclick="leaveServer()"
                                style="background-color: var(--warning); border-color: var(--warning); color: #000;">Leave
                                Server</button>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <!-- LOGS TAB -->
    <div id="tab-logs" class="tab-content" style="display: none;">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">üìú System Logs</h2>
                <div
                    style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-muted);">
                    <label for="autoscroll-toggle" style="cursor: pointer;">Autoscroll</label>
                    <input type="checkbox" id="autoscroll-toggle" checked
                        style="cursor: pointer; transform: scale(1.2);">
                </div>
            </div>
            <div id="logs" class="logs">
                <!-- Logs populated by WS -->
            </div>
        </div>
    </div>
    </main>
    </div>

    <script src="/static/dashboard.js?v=1.2"></script>
    <!-- User Profile Modal -->
    <div id="user-modal" class="modal-overlay">
        <div class="modal" style="max-width: 800px; width: 95%;">
            <div class="modal-header">
                <h2 class="modal-title" id="user-modal-title">User Profile</h2>
                <button class="btn-icon" onclick="closeUserModal()">‚úï</button>
            </div>
            <div id="user-modal-content" style="max-height: 70vh; overflow-y: auto;">
                <div class="user-profile-header"
                    style="display: flex; gap: 1.5rem; align-items: center; margin-bottom: 2rem;">
                    <div id="user-modal-avatar" class="user-avatar" style="width: 80px; height: 80px; font-size: 2rem;">
                        ?</div>
                    <div>
                        <h1 id="user-modal-name" style="margin: 0;">Username</h1>
                        <p id="user-modal-id"
                            style="color: var(--text-muted); font-size: 0.9rem; margin: 0.2rem 0 0 0;">ID: 0</p>
                    </div>
                </div>

                <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem;">
                    <div class="stat-card">
                        <div class="stat-label">Total Plays</div>
                        <div class="stat-value" id="user-modal-plays">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Reactions</div>
                        <div class="stat-value" id="user-modal-reactions">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Playlists</div>
                        <div class="stat-value" id="user-modal-playlists">0</div>
                    </div>
                </div>

                <div class="tabs" style="margin-bottom: 1rem;">
                    <button class="tab modal-tab active" data-modal-tab="reactions"
                        onclick="switchModalTab('reactions')">Liked Songs</button>
                    <button class="tab modal-tab" data-modal-tab="playlists"
                        onclick="switchModalTab('playlists')">Playlists</button>
                    <button class="tab modal-tab" data-modal-tab="preferences"
                        onclick="switchModalTab('preferences')">Affinities</button>
                </div>

                <div id="modal-tab-content">
                    <div id="modal-reactions" class="modal-tab-pane active">
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Song</th>
                                        <th>Artist</th>
                                        <th>Date</th>
                                    </tr>
                                </thead>
                                <tbody id="user-modal-reactions-list"></tbody>
                            </table>
                        </div>
                    </div>
                    <div id="modal-playlists" class="modal-tab-pane" style="display: none;">
                        <div id="user-modal-playlists-list" class="grid"
                            style="grid-template-columns: 1fr; gap: 0.5rem;"></div>
                    </div>
                    <div id="modal-preferences" class="modal-tab-pane" style="display: none;">
                        <div id="user-modal-prefs-list" class="grid"
                            style="grid-template-columns: repeat(2, 1fr); gap: 0.5rem;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>