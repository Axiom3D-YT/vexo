(function(){"use strict";var Y,pe;Y={__e:function(e,t,n,o){for(var i,s,a;t=t.__;)if((i=t.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(e)),a=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(e,o||{}),a=i.__d),a)return i.__E=i}catch(r){e=r}throw e}},pe=function(e){return e!=null&&e.constructor===void 0},typeof Promise=="function"&&Promise.prototype.then.bind(Promise.resolve());var ne,_,oe,ve,ye=0,he=[],f=Y,_e=f.__b,be=f.__r,Ee=f.diffed,ke=f.__c,Ie=f.unmount,we=f.__;function yt(e,t){f.__h&&f.__h(_,e,ye||t),ye=0;var n=_.__H||(_.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function Be(e,t){var n=yt(ne++,7);return bt(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function ht(){for(var e;e=he.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(J),e.__H.__h.forEach(ie),e.__H.__h=[]}catch(t){e.__H.__h=[],f.__e(t,e.__v)}}f.__b=function(e){_=null,_e&&_e(e)},f.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),we&&we(e,t)},f.__r=function(e){be&&be(e),ne=0;var t=(_=e.__c).__H;t&&(oe===_?(t.__h=[],_.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(J),t.__h.forEach(ie),t.__h=[],ne=0)),oe=_},f.diffed=function(e){Ee&&Ee(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(he.push(t)!==1&&ve===f.requestAnimationFrame||((ve=f.requestAnimationFrame)||_t)(ht)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),oe=_=null},f.__c=function(e,t){t.some(function(n){try{n.__h.forEach(J),n.__h=n.__h.filter(function(o){return!o.__||ie(o)})}catch(o){t.some(function(i){i.__h&&(i.__h=[])}),t=[],f.__e(o,n.__v)}}),ke&&ke(e,t)},f.unmount=function(e){Ie&&Ie(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{J(o)}catch(i){t=i}}),n.__H=void 0,t&&f.__e(t,n.__v))};var $e=typeof requestAnimationFrame=="function";function _t(e){var t,n=function(){clearTimeout(o),$e&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,35);$e&&(t=requestAnimationFrame(n))}function J(e){var t=_,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),_=t}function ie(e){var t=_;e.__c=e.__(),_=t}function bt(e,t){return!e||e.length!==t.length||t.some(function(n,o){return n!==e[o]})}var Et=Symbol.for("preact-signals");function se(){if(j>1)j--;else{for(var e,t=!1;F!==void 0;){var n=F;for(F=void 0,ae++;n!==void 0;){var o=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Te(n))try{n.c()}catch(i){t||(e=i,t=!0)}n=o}}if(ae=0,j--,t)throw e}}var c=void 0;function xe(e){var t=c;c=void 0;try{return e()}finally{c=t}}var F=void 0,j=0,ae=0,V=0;function Se(e){if(c!==void 0){var t=e.n;if(t===void 0||t.t!==c)return t={i:0,S:e,p:c.s,n:void 0,t:c,e:void 0,x:void 0,r:t},c.s!==void 0&&(c.s.n=t),c.s=t,e.n=t,32&c.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=c.s,t.n=void 0,c.s.n=t,c.s=t),t}}function v(e,t){this.v=e,this.i=0,this.n=void 0,this.t=void 0,this.W=t==null?void 0:t.watched,this.Z=t==null?void 0:t.unwatched,this.name=t==null?void 0:t.name}v.prototype.brand=Et,v.prototype.h=function(){return!0},v.prototype.S=function(e){var t=this,n=this.t;n!==e&&e.e===void 0&&(e.x=n,this.t=e,n!==void 0?n.e=e:xe(function(){var o;(o=t.W)==null||o.call(t)}))},v.prototype.U=function(e){var t=this;if(this.t!==void 0){var n=e.e,o=e.x;n!==void 0&&(n.x=o,e.e=void 0),o!==void 0&&(o.e=n,e.x=void 0),e===this.t&&(this.t=o,o===void 0&&xe(function(){var i;(i=t.Z)==null||i.call(t)}))}},v.prototype.subscribe=function(e){var t=this;return C(function(){var n=t.value,o=c;c=void 0;try{e(n)}finally{c=o}},{name:"sub"})},v.prototype.valueOf=function(){return this.value},v.prototype.toString=function(){return this.value+""},v.prototype.toJSON=function(){return this.value},v.prototype.peek=function(){var e=c;c=void 0;try{return this.value}finally{c=e}},Object.defineProperty(v.prototype,"value",{get:function(){var e=Se(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(ae>100)throw new Error("Cycle detected");this.v=e,this.i++,V++,j++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{se()}}}});function B(e,t){return new v(e,t)}function Te(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function Le(e){for(var t=e.s;t!==void 0;t=t.n){var n=t.S.n;if(n!==void 0&&(t.r=n),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Ce(e){for(var t=e.s,n=void 0;t!==void 0;){var o=t.p;t.i===-1?(t.S.U(t),o!==void 0&&(o.n=t.n),t.n!==void 0&&(t.n.p=o)):n=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=o}e.s=n}function L(e,t){v.call(this,void 0),this.x=e,this.s=void 0,this.g=V-1,this.f=4,this.W=t==null?void 0:t.watched,this.Z=t==null?void 0:t.unwatched,this.name=t==null?void 0:t.name}L.prototype=new v,L.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===V))return!0;if(this.g=V,this.f|=1,this.i>0&&!Te(this))return this.f&=-2,!0;var e=c;try{Le(this),c=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return c=e,Ce(this),this.f&=-2,!0},L.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}v.prototype.S.call(this,e)},L.prototype.U=function(e){if(this.t!==void 0&&(v.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}},L.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}},Object.defineProperty(L.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=Se(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function kt(e,t){return new L(e,t)}function qe(e){var t=e.u;if(e.u=void 0,typeof t=="function"){j++;var n=c;c=void 0;try{t()}catch(o){throw e.f&=-2,e.f|=8,re(e),o}finally{c=n,se()}}}function re(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,qe(e)}function It(e){if(c!==this)throw new Error("Out-of-order effect");Ce(this),c=e,this.f&=-2,8&this.f&&re(this),se()}function A(e,t){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=t==null?void 0:t.name}A.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{e()}},A.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,qe(this),Le(this),j++;var e=c;return c=this,It.bind(this,e)},A.prototype.N=function(){2&this.f||(this.f|=2,this.o=F,F=this)},A.prototype.d=function(){this.f|=8,1&this.f||re(this)},A.prototype.dispose=function(){this.d()};function C(e,t){var n=new A(e,t);try{n.c()}catch(i){throw n.d(),i}var o=n.d.bind(n);return o[Symbol.dispose]=o,o}var K;function G(e,t){Y[e]=t.bind(null,Y[e]||function(){})}function Z(e){if(K){var t=K;K=void 0,t()}K=e&&e.S()}function Me(e){var t=this,n=e.data,o=Bt(n);o.value=n;var i=Be(function(){for(var s=t.__v;s=s.__;)if(s.__c){s.__c.__$f|=4;break}return t.__$u.c=function(){var a,r=t.__$u.S(),l=i.value;r(),pe(l)||((a=t.base)==null?void 0:a.nodeType)!==3?(t.__$f|=1,t.setState({})):t.base.data=l},kt(function(){var a=o.value.value;return a===0?0:a===!0?"":a||""})},[]);return i.value}Me.displayName="_st",Object.defineProperties(v.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Me},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}}),G("__b",function(e,t){if(typeof t.type=="string"){var n,o=t.props;for(var i in o)if(i!=="children"){var s=o[i];s instanceof v&&(n||(t.__np=n={}),n[i]=s,o[i]=s.peek())}}e(t)}),G("__r",function(e,t){e(t),Z();var n,o=t.__c;o&&(o.__$f&=-2,(n=o.__$u)===void 0&&(o.__$u=n=function(i){var s;return C(function(){s=this}),s.c=function(){o.__$f|=1,o.setState({})},s}())),Z(n)}),G("__e",function(e,t,n,o){Z(),e(t,n,o)}),G("diffed",function(e,t){Z();var n;if(typeof t.type=="string"&&(n=t.__e)){var o=t.__np,i=t.props;if(o){var s=n.U;if(s)for(var a in s){var r=s[a];r!==void 0&&!(a in o)&&(r.d(),s[a]=void 0)}else n.U=s={};for(var l in o){var p=s[l],h=o[l];p===void 0?(p=wt(n,l,h,i),s[l]=p):p.o(h,i)}}}e(t)});function wt(e,t,n,o){var i=t in e&&e.ownerSVGElement===void 0,s=B(n);return{o:function(a,r){s.value=a,o=r},d:C(function(){var a=s.value.value;o[t]!==a&&(o[t]=a,i?e[t]=a:a?e.setAttribute(t,a):e.removeAttribute(t))})}}G("unmount",function(e,t){if(typeof t.type=="string"){var n=t.__e;if(n){var o=n.U;if(o){n.U=void 0;for(var i in o){var s=o[i];s&&s.d()}}}}else{var a=t.__c;if(a){var r=a.__$u;r&&(a.__$u=void 0,r.d())}}e(t)}),G("__h",function(e,t,n,o){(o<3||o===9)&&(t.__$f|=2),e(t,n,o)});function Bt(e){return Be(function(){return B(e)},[])}const y={status:"/api/status",guilds:"/api/guilds",guild:e=>`/api/guilds/${e}`,settings:e=>`/api/guilds/${e}/settings`,analytics:"/api/analytics",users:"/api/users",songs:"/api/songs",library:"/api/library",topSongs:"/api/analytics/top-songs",userPrefs:e=>`/api/users/${e}/preferences`,notifications:"/api/notifications",settings_global:"/api/settings/global",leave_guild:e=>`/api/guilds/${e}/leave`},$=B(null),d=B("global");let Pe=[],b=[];const le={name:"New Prompt",role:`You are a Cool, Knowledgeable Music Curator. You're not a radio DJ with a "voice"; you're that friend who always knows the perfect song for the moment. Your vibe is authentic, relaxed, and conversational.`,task:"Write a short, natural intro for the specified track.",word_count:"Keep it under 40 words.",output_format:`Return a valid JSON object with the following keys:
- "song": The song title (string)
- "artist": The artist name (string)
- "genre": The inferred genre (string)
- "release_date": The release year (string)
- "text": The intro script (string)`,guidelines:`Natural Flow: Avoid "radio announcer" clich√©s. Talk like a real person.
Connection: Focus on how the song *feels* or the specific moment it fits.
The Reveal: Have 1/3 chance to mention the Artist and Song (naturally).
Rhythm: Use natural pauses.`,vocal_cues:"Do NOT include any stage directions or bracketed text.",enabled:!0},z=B([]),D=B(1),ce=50,de=B({status:"offline"}),$t=B([]);C(()=>{We(),Ve()}),C(()=>{d.value!=="global"&&ge()}),C(()=>{Ne(de.value)}),C(()=>{Ke()}),document.addEventListener("DOMContentLoaded",()=>{je(),De(),ge(),Ve(),Ht(),setInterval(Ue,5e3),setInterval(me,1e4),setInterval(We,15e3),setInterval(ge,3e4),setInterval(Ot,15e3),document.querySelectorAll(".tab").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault(),Q(e.dataset.tab)})})});let q=null,He=new Set;function je(){try{const t=`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/logs`;console.log(`[Dashboard] Connecting to WebSocket: ${t}`),q=new WebSocket(t),q.onopen=()=>{console.log("[Dashboard] WebSocket connected")},q.onmessage=n=>{const o=JSON.parse(n.data);Ae(o)},q.onclose=n=>{console.warn("[Dashboard] WebSocket closed, retrying in 3s...",n.reason),setTimeout(je,3e3)},q.onerror=n=>console.error("[Dashboard] WebSocket error:",n)}catch(e){console.error("[Dashboard] WS Init Error",e)}}setInterval(async()=>{if(!q||q.readyState!==WebSocket.OPEN)try{const e=await fetch("/api/logs");if(e.ok){const t=await e.json();t.logs&&t.logs.forEach(n=>Ae(n))}}catch(e){console.error("[Dashboard] Polling failed",e)}},1e4);let ue=!0;document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("autoscroll-toggle");e&&e.addEventListener("change",t=>{if(ue=t.target.checked,ue){const n=document.getElementById("logs");n&&(n.scrollTop=n.scrollHeight)}})});function Ae(e){const t=document.getElementById("logs");if(!t)return;const n=t.scrollHeight-t.scrollTop<=t.clientHeight+100,o=t.children.length===0,i=`${e.timestamp}-${e.level}-${e.message.substring(0,50)}`;if(He.has(i))return;He.add(i);const s=new Date(e.timestamp*1e3).toLocaleTimeString(),a=document.createElement("div");for(a.className=`log-entry log-${e.level}`,a.innerHTML=`<span class="log-time">${s}</span> [${e.level}] ${e.message}`,t.appendChild(a),ue&&(n||o)&&(t.scrollTop=t.scrollHeight);t.children.length>500;)t.removeChild(t.firstChild)}async function Ge(e){if(!e||e==="null"||e==="undefined")return;const t=document.getElementById("user-modal");if(t){t.classList.add("open"),St();try{const o=await(await fetch(`/api/users/${e}/details`)).json();Tt(o)}catch(n){console.error("Failed to fetch user details",n),document.getElementById("user-modal-content").innerHTML='<div style="padding: 2rem; text-align: center;">Failed to load profile</div>'}}}function xt(){const e=document.getElementById("user-modal");e&&e.classList.remove("open")}function St(){document.getElementById("user-modal-name").innerHTML='<div class="skeleton skeleton-text" style="width: 150px"></div>',document.getElementById("user-modal-id").innerHTML='<div class="skeleton skeleton-text" style="width: 100px"></div>',document.getElementById("user-modal-plays").innerHTML="...",document.getElementById("user-modal-reactions").innerHTML="...",document.getElementById("user-modal-playlists").innerHTML="..."}function Tt(e){const t=e.user||{};document.getElementById("user-modal-name").textContent=t.username||"Unknown User",document.getElementById("user-modal-id").textContent=`ID: ${t.id}`,document.getElementById("user-modal-avatar").textContent=(t.username||"?").charAt(0),document.getElementById("user-modal-plays").textContent=e.reactions.length+e.imported_playlists.length*10,document.getElementById("user-modal-reactions").textContent=e.reactions.length,document.getElementById("user-modal-playlists").textContent=e.imported_playlists.length;const n=document.getElementById("user-modal-reactions-list");e.reactions.length===0?n.innerHTML='<tr><td colspan="3" style="text-align: center; color: var(--text-muted); padding: 1rem;">No likes yet</td></tr>':n.innerHTML=e.reactions.map(l=>`
            <tr>
                <td>${l.title}</td>
                <td>${l.artist_name}</td>
                <td>${new Date(l.created_at).toLocaleDateString()}</td>
            </tr>
        `).join("");const o=document.getElementById("user-modal-playlists-list");e.imported_playlists.length===0?o.innerHTML='<div style="text-align: center; color: var(--text-muted); padding: 1rem;">No playlists imported</div>':o.innerHTML=e.imported_playlists.map(l=>`
            <div class="server-nav-item" style="display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border);">
                <span>${l.name||"Untitled Playlist"}</span>
                <span style="font-size: 0.7rem; color: var(--text-muted);">${l.source||"spotify"}</span>
            </div>
        `).join("");const i=document.getElementById("user-modal-prefs-list"),s=e.preferences||{};let a="";const r=[];for(const[l,p]of Object.entries(s))for(const[h,M]of Object.entries(p))r.push({type:l,key:h,score:M});r.sort((l,p)=>p.score-l.score),r.length===0?a='<div style="grid-column: span 2; text-align: center; color: var(--text-muted);">No affinity data</div>':a=r.slice(0,20).map(l=>`
            <div style="background: var(--bg-card); padding: 0.5rem; border-radius: 6px; font-size: 0.8rem; display: flex; justify-content: space-between;">
                <span style="color: var(--text-muted);">${l.type==="genre"?"üè∑Ô∏è":"üë®‚Äçüé§"} ${l.key}</span>
                <span style="font-weight: 600;">${l.score.toFixed(1)}</span>
            </div>
        `).join(""),i.innerHTML=a}window.viewUser=Ge,window.closeUserModal=xt,window.switchModalTab=function(e){document.querySelectorAll(".modal-tab").forEach(t=>t.classList.remove("active")),document.querySelector(`.modal-tab[data-modal-tab="${e}"]`).classList.add("active"),document.querySelectorAll(".modal-tab-pane").forEach(t=>t.style.display="none"),document.getElementById(`modal-${e}`).style.display="block"};async function De(){Lt();try{const t=await(await fetch("/api/dashboard-init")).json();if(t.status&&Ne(t.status),t.guilds&&(Oe(t.guilds),d.value!=="global")){const n=t.guilds.find(o=>o.id===d.value);if(n){const o=document.getElementById("server-stat-members");o&&(o.textContent=n.member_count||0);const i=document.getElementById("server-stat-queue");i&&(i.textContent=n.queue_size||0);const s=document.getElementById("server-stat-duration");s&&(s.textContent=`${n.queue_duration||0}m`)}}Fe(t.guilds),ze(t.guilds),Re(t.analytics),$t.value=t.notifications,Ze(t.notifications),!$.value&&t.guilds.length>0&&($.value=t.guilds[0].id),Ye(t.analytics)}catch(e){console.error("Init failed",e)}}function Lt(){const e=document.getElementById("now-playing");e&&(e.innerHTML=`
        <div class="np-content">
            <div class="skeleton skeleton-artwork"></div>
            <div class="np-info">
                <div class="skeleton skeleton-text" style="width: 60%"></div>
                <div class="skeleton skeleton-text" style="width: 40%"></div>
                <div class="skeleton skeleton-text" style="width: 80%; height: 2rem; margin-top: 1rem;"></div>
            </div>
        </div>
    `),document.querySelectorAll(".stat-value").forEach(n=>n.innerHTML='<span class="skeleton skeleton-text" style="width: 40px; height: 2rem;"></span>')}async function Ue(){try{const t=await(await fetch(y.status)).json();de.value=t}catch(e){console.error("Failed to fetch status",e);try{de.value={status:"offline"}}catch{}}}function Ne(e){try{const t=document.querySelector(".status-dot"),n=document.getElementById("status-text"),o=document.getElementById("stat-guilds"),i=document.getElementById("stat-voice"),s=document.getElementById("stat-latency-val"),a=document.getElementById("stat-latency"),r=document.getElementById("stat-cpu"),l=document.getElementById("stat-ram");t&&(t.className=`status-dot status-${e.status==="online"?"online":"offline"}`),n&&(n.textContent=e.status==="online"?`Online (${e.latency_ms||0}ms)`:"Offline"),o&&(o.textContent=e.guilds||0),i&&(i.textContent=e.voice_connections||0),s&&(s.textContent=`${e.latency_ms||0}ms`),a&&(a.textContent=`${e.latency_ms||0}ms`),r&&(r.textContent=e.cpu_percent||0),l&&(l.textContent=e.ram_percent||0);const p=document.getElementById("stat-uptime");p&&(p.textContent=Qe(e.uptime_seconds))}catch(t){console.error("Error updating status",t)}}async function me(){try{const t=await(await fetch(y.guilds)).json();if(!$.value&&t.guilds&&t.guilds.length>0&&($.value=t.guilds[0].id),Oe(t.guilds||[]),Fe(t.guilds||[]),ze(t.guilds||[]),d.value!=="global"&&t.guilds){const n=t.guilds.find(o=>o.id===d.value);if(n){const o=document.getElementById("server-stat-members");o&&(o.textContent=n.member_count||0);const i=document.getElementById("server-stat-queue");i&&(i.textContent=n.queue_size||0);const s=document.getElementById("server-stat-duration");s&&(s.textContent=`${n.queue_duration||0}m`)}}}catch(e){console.error("Failed to fetch guilds",e)}}function Oe(e){const t=document.getElementById("server-nav");if(!t)return;let n=`<div class="server-nav-item ${d.value==="global"?"active":""}" onclick="switchScope('global')">Global</div>`;n+=e.map(o=>`
        <div class="server-nav-item ${d.value===o.id?"active":""}" onclick="switchScope('${o.id}')">
            ${o.name||"Server"}
            ${o.is_playing?" üîä":""}
        </div>
    `).join(""),t.innerHTML=n}function Fe(e){const t=document.getElementById("guild-list");t&&(t.innerHTML=e.map(n=>`
        <div class="user-item ${n.id===$.value?"active":""}" onclick="selectGuild(event, '${n.id}')">
            <div class="user-avatar">${(n.name||"?").charAt(0)}</div>
            <div class="user-info">
                <div class="user-name">${n.name||"Unknown Server"}</div>
                <div class="user-stats">${n.member_count||0} members</div>
            </div>
            <div class="user-actions" style="display: flex; gap: 0.5rem; align-items: center;">
                ${n.is_playing?'<span style="color: var(--success); font-size: 0.8rem;">‚ñ∂ Playing</span>':""}
                <button class="btn btn-secondary" style="padding: 0.2rem 0.5rem; font-size: 0.7rem;" onclick="event.stopPropagation(); leaveGuild('${n.id}')">Leave</button>
            </div>
        </div>
    `).join(""))}async function Ct(e){if(confirm("Are you sure you want the bot to leave this server?"))try{(await fetch(y.leave_guild(e),{method:"POST"})).ok?me():alert("Failed to leave server")}catch(t){console.error(t),alert("Error leaving server")}}async function qt(){if(!d.value||d.value==="global")return;const e=d.value;if(confirm("Are you sure you want the bot to leave this server? This action is permanent!"))try{(await fetch(y.leave_guild(e),{method:"POST"})).ok?(alert("Bot has left the server."),fe("global"),De()):alert("Failed to leave server")}catch(t){console.error(t),alert("Error leaving server")}}function ze(e){const t=document.getElementById("now-playing");if(!t)return;let n=null;if(d.value==="global"?n=e.find(o=>o.is_playing&&o.current_song):n=e.find(o=>o.id===d.value&&o.is_playing&&o.current_song),n){let o="";if(n.duration_seconds){const i=Math.floor(n.duration_seconds/60),s=n.duration_seconds%60;o=`${i}:${s.toString().padStart(2,"0")}`}t.innerHTML=`
            <div class="np-content">
                <img class="np-artwork" src="https://img.youtube.com/vi/${n.video_id||"dQw4w9WgXcQ"}/hqdefault.jpg" alt="Album art">
                <div class="np-info">
                    <div class="np-title">${n.current_song||"Unknown"}</div>
                    <div class="np-artist">${n.current_artist||"Unknown Artist"}</div>
                    <div class="np-metadata">
                        ${o?`<span>‚è≥ ${o}</span>`:""}
                        ${n.genre?`<span>üè∑Ô∏è ${n.genre}</span>`:""}
                        ${n.year?`<span>üìÖ ${n.year}</span>`:""}
                    </div>
                    ${n.discovery_reason?`<div class="np-discovery">${n.discovery_reason}</div>`:""}
                    <div class="np-controls">
                        <button class="np-btn" onclick="control('pause')">‚è∏Ô∏è</button>
                        <button class="np-btn" onclick="control('skip')">‚è≠Ô∏è</button>
                        <button class="np-btn" onclick="control('stop')">‚èπÔ∏è</button>
                    </div>
                </div>
            </div>
        `,t.style.display="block"}else t.innerHTML='<div class="np-content" style="justify-content: center;"><span style="color: var(--text-muted);">Nothing playing</span></div>'}async function We(){try{let e=y.analytics;d.value!=="global"&&(e+=`?guild_id=${d.value}`);const n=await(await fetch(e)).json();Re(n)}catch(e){console.error("Failed to fetch analytics",e)}}function Re(e){var t,n,o,i,s,a,r,l,p;try{const h=document.getElementById("stat-songs"),M=document.getElementById("stat-users"),W=document.getElementById("stat-plays");W&&(W.textContent=e.total_plays||0);const x=document.getElementById("stat-uptime");x&&e.uptime_seconds&&(x.textContent=Qe(e.uptime_seconds)),h&&(h.textContent=e.total_songs||0),M&&(M.textContent=e.total_users||0);const u=document.getElementById("stat-songs-global");u&&(u.textContent=e.total_songs||0);const S=document.getElementById("stat-plays-global");S&&(S.textContent=e.total_plays||0);const k=document.getElementById("stat-users-global");k&&(k.textContent=e.total_users||0);const I=document.getElementById("top-songs-table");I&&(!e.top_songs||e.top_songs.length===0?I.innerHTML='<tr><td colspan="4" style="text-align: center; color: var(--text-muted); padding: 2rem;">No songs played yet</td></tr>':I.innerHTML=e.top_songs.slice(0,10).map((g,T)=>`
                    <tr>
                        <td>${T+1}</td>
                        <td>
                            <div class="song-cell">
                                <img class="song-thumb" src="https://img.youtube.com/vi/${g.yt_id}/default.jpg" alt="">
                                <div class="song-info">
                                    <span class="song-name">${g.title}</span>
                                    <span class="song-artist">${g.artist}</span>
                                </div>
                            </div>
                        </td>
                        <td>${g.plays}</td>
                        <td>${g.likes} ‚ù§Ô∏è</td>
                    </tr>
                `).join(""));const E=document.getElementById("top-users-list");E&&(!e.top_users||e.top_users.length===0?E.innerHTML='<div style="text-align: center; color: var(--text-muted); padding: 1rem;">No users active yet</div>':E.innerHTML=e.top_users.slice(0,10).map(g=>`
                    <div class="user-item" style="cursor: pointer" onclick="viewUser('${g.id}')">
                        <div class="user-avatar">${(g.name||"?").charAt(0)}</div>
                        <div class="user-info">
                            <div class="user-name">${g.name||"Unknown"}</div>
                            <div class="user-stats">${g.plays||0} plays ‚Ä¢ ${g.total_likes||0} likes</div>
                        </div>
                    </div>
                `).join(""));const P={"insight-liked-genre":(n=(t=e.top_liked_genres)==null?void 0:t[0])==null?void 0:n.name,"insight-liked-artist":(i=(o=e.top_liked_artists)==null?void 0:o[0])==null?void 0:i.name,"insight-liked-song":(s=e.top_liked_songs)!=null&&s[0]?`${e.top_liked_songs[0].title} by ${e.top_liked_songs[0].artist}`:null,"insight-played-genre":(r=(a=e.top_played_genres)==null?void 0:a[0])==null?void 0:r.name,"insight-played-artist":(p=(l=e.top_played_artists)==null?void 0:l[0])==null?void 0:p.name};for(const[g,T]of Object.entries(P)){const H=document.getElementById(g);H&&(H.textContent=T||"-")}const N=document.getElementById("useful-users-list");N&&(!e.top_useful_users||e.top_useful_users.length===0?N.innerHTML='<div style="text-align: center; color: var(--text-muted); padding: 1rem;">No useful activity yet</div>':N.innerHTML=e.top_useful_users.map(g=>`
                    <div class="user-item">
                        <div class="user-avatar" style="background: var(--gradient-2)">${(g.username||"?").charAt(0)}</div>
                        <div class="user-info">
                            <div class="user-name">${g.username||"Unknown"}</div>
                            <div class="user-stats">${g.score||0} helpfulness points</div>
                        </div>
                    </div>
                `).join("")),Je(e),d.value!=="global"&&Mt(e)}catch(h){console.error("Error updating analytics",h)}}let m={};function Ye(e){if(!window.Chart)return;const t={primary:"#8b5cf6",secondary:"#ec4899",tertiary:"#06b6d4",text:"#64748b"},n=document.getElementById("plays-chart");n&&(m.plays&&m.plays.destroy(),m.plays=new Chart(n,{type:"line",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Plays",data:e.playback_trends||[10,25,15,30,45,20,35],borderColor:t.primary,backgroundColor:"rgba(139, 92, 246, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:t.text}},x:{grid:{display:!1},ticks:{color:t.text}}}}}));const o=document.getElementById("genres-chart");if(o){m.genres&&m.genres.destroy();const a=(e.top_played_genres||[]).slice(0,5);m.genres=new Chart(o,{type:"doughnut",data:{labels:a.map(r=>r.name||"Unknown"),datasets:[{data:a.map(r=>r.plays||0),backgroundColor:[t.primary,t.secondary,t.tertiary,"#f59e0b","#10b981"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:t.text,padding:20}}}}})}const i=document.getElementById("server-plays-chart");i&&(m.serverPlays&&m.serverPlays.destroy(),m.serverPlays=new Chart(i,{type:"line",data:{labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Server Plays",data:e.playback_trends||[0,0,0,0,0,0,0],borderColor:t.secondary,backgroundColor:"rgba(236, 72, 153, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:t.text}},x:{grid:{display:!1},ticks:{color:t.text}}}}}));const s=document.getElementById("peak-chart");s&&(m.peak&&m.peak.destroy(),m.peak=new Chart(s,{type:"bar",data:{labels:Array.from({length:24},(a,r)=>`${r}h`),datasets:[{label:"Plays",data:e.peak_hours||Array(24).fill(0),backgroundColor:t.tertiary,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:t.text}},x:{grid:{display:!1},ticks:{color:t.text,font:{size:9}}}}}}))}function Je(e){if(e){if(m.plays&&e.playback_trends&&(m.plays.data.datasets[0].data=e.playback_trends,m.plays.update()),m.genres&&e.top_played_genres){const t=e.top_played_genres.slice(0,5);m.genres.data.labels=t.map(n=>n.name),m.genres.data.datasets[0].data=t.map(n=>n.plays),m.genres.update()}m.peak&&e.peak_hours&&(m.peak.data.datasets[0].data=e.peak_hours,m.peak.update())}}function Mt(e){m.serverPlays&&e.playback_trends&&(m.serverPlays.data.datasets[0].data=e.playback_trends,m.serverPlays.update())}async function ge(){try{let e=y.songs;d.value!=="global"&&(e+=`?guild_id=${d.value}`);const n=await(await fetch(e)).json();Pt(n.songs||[])}catch(e){console.error(e)}}function Pt(e){const t=document.getElementById("songs-list");if(t){if(e.length===0){t.innerHTML='<tr><td colspan="4" style="text-align: center; color: var(--text-muted);">No songs found</td></tr>';return}t.innerHTML=e.map(n=>{let o="-";if(n.duration_seconds){const s=Math.floor(n.duration_seconds/60),a=n.duration_seconds%60;o=`${s}:${a.toString().padStart(2,"0")}`}let i=n.played_at?new Date(n.played_at).toLocaleString():"Never";return`
            <tr>
                <td>${n.title}</td>
                <td>${n.artist_name}</td>
                <td>${o}</td>
                <td>${n.genre||"-"}</td>
                <td><span class="user-list" style="cursor: pointer" onclick="viewUser('${n.requested_by_id}')">${n.requested_by||"-"}</span></td>
                <td><span class="user-list liked">${n.liked_by||"-"}</span></td>
                <td><span class="user-list disliked">${n.disliked_by||"-"}</span></td>
                <td>${i}</td>
            </tr>
        `}).join("")}}async function Ht(){try{let e=y.users;d.value!=="global"&&(e+=`?guild_id=${d.value}`);const n=await(await fetch(e)).json();jt(n.users||[])}catch(e){console.error(e)}}function jt(e){const t=document.getElementById("users-directory");if(t){if(e.length===0){t.innerHTML='<div style="text-align: center; color: var(--text-muted);">No users found</div>';return}t.innerHTML=e.map(n=>`
        <div class="user-item" style="cursor: pointer" onclick="viewUser('${n.id}')">
            <div class="user-avatar">${(n.username||"?").charAt(0)}</div>
            <div class="user-info">
                <div class="user-name">${n.username||"Unknown"}</div>
                <div class="user-stats">${n.formatted_id||n.discord_id||"ID: "+n.id}</div>
            </div>
            <div class="user-metrics" style="margin-left: auto; text-align: right; font-size: 0.8rem; color: var(--text-muted);">
                <div>${n.reactions||0} reactions</div>
                <div>${n.playlists||0} playlists</div>
            </div>
        </div>
    `).join("")}}async function Ve(){try{let e=y.library;d.value!=="global"&&(e+=`?guild_id=${d.value}`);const n=await(await fetch(e)).json();z.value=n.library||[],D.value=1,Ke()}catch(e){console.error(e)}}function Ke(){const e=document.getElementById("library-list"),t=document.getElementById("library-pagination");if(!e||!t)return;if(z.value.length===0){e.innerHTML='<tr><td colspan="6" style="text-align: center; color: var(--text-muted);">Library is empty</td></tr>',t.innerHTML="";return}const n=(D.value-1)*ce,o=n+ce,i=z.value.slice(n,o);e.innerHTML=i.map(a=>{let r=a.last_added?new Date(a.last_added).toLocaleDateString():"-";const l={request:"üì® Request",like:"‚ù§Ô∏è Like",import:"üì• Import"},p=(a.sources||"").split(",").map(h=>l[h]||h).join(", ");return`
            <tr>
                <td>${a.title}</td>
                <td>${a.artist_name}</td>
                <td>${a.genre||"-"}</td>
                <td>${p}</td>
                <td><span class="user-list">${a.contributors||"-"}</span></td>
                <td>${r}</td>
            </tr>
        `}).join("");const s=Math.ceil(z.value.length/ce);t.innerHTML=`
        <button class="page-btn" ${D.value===1?"disabled":""} onclick="changeLibraryPage(-1)">Previous</button>
        <span class="page-info">Page ${D.value} of ${s} (${z.value.length} items)</span>
        <button class="page-btn" ${D.value===s?"disabled":""} onclick="changeLibraryPage(1)">Next</button>
    `}function At(e){D.value+=e,document.getElementById("library-table").scrollIntoView({behavior:"smooth",block:"start"})}function Gt(e,t){$.value=t,document.querySelectorAll(".user-item").forEach(n=>n.classList.remove("active")),e&&e.currentTarget&&e.currentTarget.classList.add("active")}function Dt(e){$.value&&fetch(`/api/guilds/${$.value}/control/${e}`,{method:"POST"}).then(()=>setTimeout(me,200))}function Q(e){document.querySelectorAll(".tab").forEach(o=>o.classList.remove("active"));const t=document.querySelector(`[data-tab="${e}"]`);t&&t.classList.add("active"),document.querySelectorAll(".tab-content").forEach(o=>o.style.display="none");const n=document.getElementById(`tab-${e}`);n&&(n.style.display="block"),e==="settings"&&Nt()}async function fe(e,t="dashboard"){if(d.value=e,e==="global"?(document.body.classList.remove("view-server"),document.body.classList.add("view-global")):(document.body.classList.remove("view-global"),document.body.classList.add("view-server")),document.querySelectorAll(".server-nav-item").forEach(n=>{var o;n.classList.remove("active"),e==="global"&&n.textContent.includes("Global")&&n.classList.add("active"),(o=n.getAttribute("onclick"))!=null&&o.includes(`'${e}'`)&&n.classList.add("active")}),e==="global"){Ue(),Q(t);const n=document.getElementById("stat-guilds");n&&(n.nextElementSibling.textContent="Servers")}else try{const o=await(await fetch(y.guild(e))).json(),i=document.getElementById("stat-guilds");i&&(i.textContent=o.queue_size||0,i.nextElementSibling.textContent="In Queue"),Q(t)}catch(n){console.error(e,n)}}function Ut(){fe("global","settings")}async function Nt(){var o,i,s,a,r,l,p,h,M,W;const e=document.getElementById("settings-title"),t=document.getElementById("settings-global"),n=document.getElementById("settings-server");if(d.value==="global"){e&&(e.textContent="‚öôÔ∏è Global Settings"),t&&(t.style.display="block"),n&&(n.style.display="none");try{const u=await(await fetch(y.settings_global)).json(),S=document.getElementById("setting-max-servers-tab");S&&(S.value=u.max_concurrent_servers||"");const k=document.getElementById("setting-test-mode");k&&(k.checked=!!u.test_mode);const I=document.getElementById("setting-test-duration");I&&(I.value=u.playback_duration||30);const E=u.groq_enabled!==!1}catch(x){console.error(x)}}else{e&&(e.textContent="‚öôÔ∏è Server Settings"),t&&(t.style.display="none"),n&&(n.style.display="block");try{const u=await(await fetch(y.settings(d.value))).json(),S=document.getElementById("setting-pre-buffer");S&&(S.checked=!!u.pre_buffer);const k=document.getElementById("setting-buffer-amount");if(k){k.value=u.buffer_amount||1;const w=document.getElementById("buffer-val");w&&(w.textContent=k.value)}const I=document.getElementById("setting-247");I&&(I.checked=!!u.twenty_four_seven);const E=document.getElementById("setting-autoconnect");E&&(E.checked=!!u.auto_connect),U("autoconnect-options",E==null?void 0:E.checked);try{Pe=(await(await fetch(y.guild(d.value))).json()).voice_channels||[],Jt(u.auto_connect_channel)}catch(w){console.error("Failed to fetch voice channels",w)}const P=document.getElementById("setting-groq-enabled");P&&(P.checked=u.groq_enabled!==!1),U("groq-advanced-options",P==null?void 0:P.checked);const N=document.getElementById("setting-groq-text");N&&(N.checked=u.groq_send_text!==!1);const g=document.getElementById("setting-groq-offset");g&&(g.value=u.groq_offset||0);const T=document.getElementById("setting-groq-model"),H=document.getElementById("setting-groq-model-custom");if(T&&H){const w=u.groq_model||"groq/compound-mini";Array.from(T.options).map(an=>an.value).includes(w)?(T.value=w,H.style.display="none"):(T.value="custom",H.value=w,H.style.display="block")}const ot=document.getElementById("setting-groq-model-fallback");ot&&(ot.value=u.groq_model_fallback||""),b=u.groq_custom_prompts||[],X();const R=document.getElementById("setting-tts-enabled");R&&(R.checked=!!u.tts_enabled),U("tts-options",R==null?void 0:R.checked);const it=document.getElementById("setting-tts-slow");it&&(it.checked=!!u.tts_slow),Vt(u.tts_voice);const st=document.getElementById("setting-max-duration");st&&(st.value=u.max_song_duration||6);const at=document.getElementById("setting-ephemeral-duration");at&&(at.value=u.ephemeral_duration||10);const te=u.discovery_weights||{similar:25,artist:25,wildcard:25,library:25},rt=document.getElementById("weight-similar");rt&&(rt.value=te.similar||0);const lt=document.getElementById("weight-artist");lt&&(lt.value=te.artist||0);const ct=document.getElementById("weight-wildcard");ct&&(ct.value=te.wildcard||0);const dt=document.getElementById("weight-library");dt&&(dt.value=te.library||0),Rt();const O=u.metadata_config||{strategy:"fallback",engines:{spotify:{enabled:!0,priority:1},discogs:{enabled:!0,priority:2},musicbrainz:{enabled:!0,priority:3}}},ut=document.getElementById("meta-strategy");ut&&(ut.value=O.strategy||"fallback");const mt=document.getElementById("meta-discogs-enabled");mt&&(mt.checked=((i=(o=O.engines)==null?void 0:o.discogs)==null?void 0:i.enabled)!==!1);const gt=document.getElementById("meta-discogs-prio");gt&&(gt.value=((a=(s=O.engines)==null?void 0:s.discogs)==null?void 0:a.priority)||2);const ft=document.getElementById("meta-mb-enabled");ft&&(ft.checked=((l=(r=O.engines)==null?void 0:r.musicbrainz)==null?void 0:l.enabled)!==!1);const pt=document.getElementById("meta-mb-prio");pt&&(pt.value=((h=(p=O.engines)==null?void 0:p.musicbrainz)==null?void 0:h.priority)||3);const vt=document.getElementById("meta-spotify-prio");vt&&(vt.value=((W=(M=O.engines)==null?void 0:M.spotify)==null?void 0:W.priority)||1)}catch(x){console.error(x)}}}async function Ot(){try{const t=await(await fetch(y.notifications)).json();Ze(t.notifications||[])}catch(e){console.error(e)}}function Ze(e){const t=document.getElementById("notif-list"),n=document.getElementById("notif-dot");if(t){if(e.length===0){t.innerHTML='<div class="notif-item" style="color: var(--text-muted); text-align: center;">No new notifications</div>',n&&(n.style.display="none");return}n&&(n.style.display="block"),t.innerHTML=e.map(o=>`
        <div class="notif-item">
            <div style="font-weight: 500; color: var(--${o.level==="error"?"error":o.level==="warning"?"warning":"text-primary"})">${o.level.toUpperCase()}</div>
            <div>${o.message}</div>
            <div class="notif-time">${new Date(o.created_at*1e3).toLocaleString()}</div>
        </div>
    `).join("")}}function Ft(){dd&&dd.classList.toggle("show")}async function zt(){if(!d.value||d.value==="global")return;const e=d.value,t={pre_buffer:document.getElementById("setting-pre-buffer").checked,buffer_amount:parseInt(document.getElementById("setting-buffer-amount").value),max_song_duration:parseInt(document.getElementById("setting-max-duration").value)||6,ephemeral_duration:parseInt(document.getElementById("setting-ephemeral-duration").value)||10,twenty_four_seven:document.getElementById("setting-247").checked,auto_connect:document.getElementById("setting-autoconnect").checked,auto_connect_channel:document.getElementById("setting-autoconnect-channel").value,groq_enabled:document.getElementById("setting-groq-enabled").checked,groq_send_text:document.getElementById("setting-groq-text").checked,groq_offset:parseInt(document.getElementById("setting-groq-offset").value||0),groq_model:document.getElementById("setting-groq-model").value==="custom"?document.getElementById("setting-groq-model-custom").value:document.getElementById("setting-groq-model").value,groq_model_fallback:document.getElementById("setting-groq-model-fallback").value,groq_model_fallback:document.getElementById("setting-groq-model-fallback").value,groq_custom_prompts:b,tts_enabled:document.getElementById("setting-tts-enabled").checked,tts_voice:document.getElementById("setting-tts-voice").value,tts_slow:document.getElementById("setting-tts-slow").checked,discovery_weights:{similar:parseInt(document.getElementById("weight-similar").value)||0,artist:parseInt(document.getElementById("weight-artist").value)||0,wildcard:parseInt(document.getElementById("weight-wildcard").value)||0,library:parseInt(document.getElementById("weight-library").value)||0},metadata_config:{strategy:document.getElementById("meta-strategy").value,engines:{groq:{enabled:document.getElementById("meta-groq-enabled").checked,priority:parseInt(document.getElementById("meta-groq-prio").value)||1},spotify:{enabled:!0,priority:parseInt(document.getElementById("meta-spotify-prio").value)||2},discogs:{enabled:document.getElementById("meta-discogs-enabled").checked,priority:parseInt(document.getElementById("meta-discogs-prio").value)||3},musicbrainz:{enabled:document.getElementById("meta-mb-enabled").checked,priority:parseInt(document.getElementById("meta-mb-prio").value)||4}}}};try{(await fetch(y.settings(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok?alert("Settings saved!"):alert("Failed to save settings")}catch(n){console.error(n),alert("Error saving settings")}}async function Wt(){const e=document.getElementById("setting-max-servers-tab").value,t=document.getElementById("setting-test-mode").checked,n=document.getElementById("setting-test-duration").value;try{(await fetch(y.settings_global,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({max_concurrent_servers:e?parseInt(e):null,test_mode:t,playback_duration:n?parseInt(n):30})})).ok?alert("Global settings saved!"):alert("Failed to save global settings")}catch(o){console.error(o),alert("Error saving global settings")}}function Rt(){const e=parseInt(document.getElementById("weight-similar").value)||0,t=parseInt(document.getElementById("weight-artist").value)||0,n=parseInt(document.getElementById("weight-wildcard").value)||0,o=parseInt(document.getElementById("weight-library").value)||0,i=e+t+n+o,s=document.getElementById("weights-total");s&&(s.textContent=i,s.style.color=i===100?"var(--text-primary)":"var(--warning)");const a=document.getElementById("weight-error");a&&(a.style.display=i===100?"none":"block")}function Qe(e){if(!e)return"0s";const t=Math.floor(e/(24*3600));e%=24*3600;const n=Math.floor(e/3600);e%=3600;const o=Math.floor(e/60),i=e%60;let s=[];return t>0&&s.push(`${t}d`),n>0&&s.push(`${n}h`),o>0&&s.push(`${o}m`),(i>0||s.length===0)&&s.push(`${i}s`),s.join(" ")}function Yt(){const e=document.getElementById("setting-groq-model"),t=document.getElementById("setting-groq-model-custom");e&&t&&(t.style.display=e.value==="custom"?"block":"none")}function U(e,t){const n=document.getElementById(e);n&&(n.style.display=t?"block":"none")}document.addEventListener("change",e=>{e.target.id==="setting-autoconnect"&&U("autoconnect-options",e.target.checked),e.target.id==="setting-groq-enabled"&&U("groq-advanced-options",e.target.checked),e.target.id==="setting-tts-enabled"&&U("tts-options",e.target.checked)});function Jt(e){const t=document.getElementById("setting-autoconnect-channel");t&&(t.innerHTML='<option value="">Select a channel...</option>'+Pe.map(n=>`<option value="${n.id}" ${n.id===String(e)?"selected":""}>${n.name}</option>`).join(""))}const Xe={tiktok:[{id:"en_us_ghostface",name:"Ghost Face"},{id:"en_us_c3po",name:"C3PO"},{id:"en_us_stitch",name:"Stitch"},{id:"en_us_stormtrooper",name:"Stormtrooper"},{id:"en_us_rocket",name:"Rocket"},{id:"en_female_madam_leota",name:"Madame Leota"},{id:"en_male_ghosthost",name:"Ghost Host"},{id:"en_male_pirate",name:"Pirate"},{id:"en_us_001",name:"English US (Default)"},{id:"en_us_002",name:"Jessie"},{id:"en_us_006",name:"Joey"},{id:"en_us_007",name:"Professor"},{id:"en_us_009",name:"Scientist"},{id:"en_us_010",name:"Confidence"},{id:"en_male_jomboy",name:"Game On"},{id:"en_female_samc",name:"Empathetic"},{id:"en_male_cody",name:"Serious"},{id:"en_female_makeup",name:"Beauty Guru"},{id:"en_female_richgirl",name:"Bestie"},{id:"en_male_grinch",name:"Trickster"},{id:"en_male_narration",name:"Story Teller"},{id:"en_male_deadpool",name:"Mr. GoodGuy"},{id:"en_male_jarvis",name:"Alfred"},{id:"en_male_ashmagic",name:"ashmagic"},{id:"en_male_olantekkers",name:"olantekkers"},{id:"en_male_ukneighbor",name:"Lord Cringe"},{id:"en_male_ukbutler",name:"Mr. Meticulous"},{id:"en_female_shenna",name:"Debutante"},{id:"en_female_pansino",name:"Varsity"},{id:"en_male_trevor",name:"Marty"},{id:"en_female_betty",name:"Bae"},{id:"en_male_cupid",name:"Cupid"},{id:"en_female_grandma",name:"Granny"},{id:"en_male_wizard",name:"Magician"},{id:"en_uk_001",name:"Narrator"},{id:"en_uk_003",name:"Male English UK"},{id:"en_au_001",name:"Metro"},{id:"en_au_002",name:"Smooth"},{id:"es_mx_002",name:"Warm"}],gtts:[{id:"en",name:"English (gTTS)"},{id:"it",name:"Italian (gTTS)"},{id:"fr",name:"French (gTTS)"},{id:"es",name:"Spanish (gTTS)"},{id:"de",name:"German (gTTS)"}]};function Vt(e){const t=document.getElementById("tts-voices-tiktok"),n=document.getElementById("tts-voices-gtts"),o=document.getElementById("setting-tts-voice");!o||!t||!n||(t.innerHTML=Xe.tiktok.map(i=>`<option value="${i.id}" ${i.id===e?"selected":""}>${i.name}</option>`).join(""),n.innerHTML=Xe.gtts.map(i=>`<option value="${i.id}" ${i.id===e?"selected":""}>${i.name}</option>`).join(""),e&&(o.value=e))}function X(){const e=document.getElementById("groq-prompts-list");e&&(e.innerHTML=b.map((t,n)=>{let o=t.name||`Custom Prompt ${n+1}`,i=t.enabled!==!1;return(typeof t=="string"||t.text&&!t.role)&&(o=`(Legacy) ${o}`),`
            <div class="groq-prompt-item" style="display: flex; gap: 0.5rem; align-items: center; background: rgba(255,255,255,0.03); padding: 0.75rem; border-radius: 6px; border: 1px solid var(--border);">
                <input type="checkbox" onchange="toggleGroqPrompt(${n})" ${i?"checked":""} style="transform: scale(1.2); cursor: pointer;">
                
                <div style="flex: 1; margin-left: 0.5rem;">
                    <div style="font-weight: 500;">${o}</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 300px;">
                        ${t.role?t.role.substring(0,50)+"...":(t.text||"").substring(0,50)+"..."}
                    </div>
                </div>

                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-secondary btn-sm" onclick="openPromptEditor(${n})">Edit</button>
                    <button class="btn btn-icon btn-sm" onclick="deleteGroqPrompt(${n})" style="color: var(--danger); font-size: 1rem;">‚úï</button>
                </div>
            </div>
        `}).join(""))}function Kt(e){b[e]&&(b[e].enabled=!b[e].enabled)}function Zt(e){confirm("Are you sure you want to delete this prompt?")&&(b.splice(e,1),X())}function ee(e=-1){const t=document.getElementById("prompt-editor-modal");if(!t)return;document.getElementById("edit-prompt-index").value=e,document.getElementById("prompt-editor-title").textContent=e>=0?"Edit Prompt":"New Prompt";let n;e>=0?(n=b[e],typeof n=="string"?n={...le,role:n,name:`Legacy ${e+1}`}:n.text&&!n.role&&(n={...le,role:n.text,name:n.name||`Legacy ${e+1}`})):n=JSON.parse(JSON.stringify(le)),document.getElementById("edit-prompt-name").value=n.name||"",document.getElementById("edit-prompt-role").value=n.role||"",document.getElementById("edit-prompt-task").value=n.task||"",document.getElementById("edit-prompt-guidelines").value=n.guidelines||"",document.getElementById("edit-prompt-vocal").value=n.vocal_cues||"",document.getElementById("edit-prompt-words").value=n.word_count||"",document.getElementById("edit-prompt-format").value=n.output_format||"",t.classList.add("open")}function et(){document.getElementById("prompt-editor-modal").classList.remove("open")}function Qt(){const e=parseInt(document.getElementById("edit-prompt-index").value),t={name:document.getElementById("edit-prompt-name").value,role:document.getElementById("edit-prompt-role").value,task:document.getElementById("edit-prompt-task").value,guidelines:document.getElementById("edit-prompt-guidelines").value,vocal_cues:document.getElementById("edit-prompt-vocal").value,word_count:document.getElementById("edit-prompt-words").value,output_format:document.getElementById("edit-prompt-format").value,enabled:!0};e>=0&&b[e]?(t.enabled=b[e].enabled,b[e]=t):b.push(t),X(),et()}function Xt(){const e=document.getElementById("preset-modal");e&&e.classList.add("open")}function tt(){const e=document.getElementById("preset-modal");e&&e.classList.remove("open")}function en(e){const t={friend:{name:"The Friend",role:"You are a close friend hanging out. Relaxed, casual, and authentic.",task:"Introduce the song like you're passing the aux cord.",vocal_cues:"Warm, casual tone. Use contractions.",guidelines:"Don't sound robotic. Be brief."},critic:{name:"The Critic",role:"You are a sophisticated music critic. Knowledgeable but slightly pretentious.",task:"Analyze the track's composition or historical context briefly.",vocal_cues:"Articulate, slightly haughty but passionate.",guidelines:"Focus on technical details or genre context."},hype:{name:"Hype Man",role:"You are a high-energy club MC.",task:"Get the crowd ready for the drop.",vocal_cues:"Loud, energetic, fast-paced.",guidelines:"Use exclamation points! shorter sentences."},jazz:{name:"Jazz Cat",role:"You are a smooth late-night jazz radio host.",task:"Set a moody, atmospheric vibe.",vocal_cues:"Deep, slow, smooth voice. Pauses for effect.",guidelines:"Use poetic language. 'Cool', 'Groovy', 'Smooth'."},history:{name:"History Buff",role:"You are a music historian.",task:"Share a fun fact or trivia about the song or year.",vocal_cues:"Educational, clearly spoken.",guidelines:"Did you know? Start with a fact."},zen:{name:"Zen Master",role:"You are a mindfulness guide.",task:"Help the listener relax into the soundscape.",vocal_cues:"Soft, whispery, calm.",guidelines:"Focus on breath and feeling."}};t[e]&&(ee(-1),setTimeout(()=>{const n=t[e];document.getElementById("edit-prompt-name").value=n.name,document.getElementById("edit-prompt-role").value=n.role,document.getElementById("edit-prompt-task").value=n.task,document.getElementById("edit-prompt-vocal").value=n.vocal_cues,document.getElementById("edit-prompt-guidelines").value=n.guidelines},50)),tt()}function tn(){const e=document.getElementById("autogen-modal");e&&e.classList.add("open")}function nt(){const e=document.getElementById("autogen-modal");e&&e.classList.remove("open")}async function nn(){const e=document.getElementById("autogen-persona").value,t=document.getElementById("autogen-vibe").value,n=document.getElementById("autogen-detail").value;let o="",i="";switch(e){case"DJ":o="You are a professional radio DJ.";break;case"Expert":o="You are a music musicologist with deep knowledge.";break;case"Fan":o="You are the world's biggest fan of this artist.";break;case"Rapper":o="You are a hip-hop MC with flow.";break;case"Poet":o="You are a poet describing the soundscape.";break}o+=` Your vibe is ${t}.`,n==="brief"?i="Keep it extremely short. One punchy sentence.":n==="balanced"?i="Write 2-3 engaging sentences.":n==="deep"&&(i="Write a rich, detailed paragraph."),ee(-1),setTimeout(()=>{document.getElementById("edit-prompt-name").value=`Auto: ${e} (${t})`,document.getElementById("edit-prompt-role").value=o,document.getElementById("edit-prompt-task").value="Introduce the upcoming track based on your persona.",document.getElementById("edit-prompt-guidelines").value=i,document.getElementById("edit-prompt-vocal").value=`Match the ${t} energy.`},50),nt()}function on(){ee(-1)}Object.assign(window,{switchTab:Q,switchScope:fe,control:Dt,changeLibraryPage:At,selectGuild:Gt,leaveGuild:Ct,leaveServer:qt,saveServerSettings:zt,saveSettingsTab:Wt,toggleNotifications:Ft,viewUser:Ge,openGlobalSettings:Ut,initCharts:Ye,updateCharts:Je,showPresetLoader:Xt,closePresetModal:tt,loadPreset:en,openAutogenerateModal:tn,closeAutogenModal:nt,applyAutogen:nn,toggleCustomModelInput:Yt,renderGroqPrompts:X,openPromptEditor:ee,closePromptEditor:et,savePrompt:Qt,deleteGroqPrompt:Zt,toggleGroqPrompt:Kt,addGroqPrompt:on})})();
